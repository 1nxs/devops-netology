# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

* Linux
  `ip link show`
  `ifconfig -a`
  `ip a`
* Windows
  `ipconfig /all`

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

* Чаще всего используются протоколы обнаружения канального уровня реализованные по стандарту IEEE 802.1AB\
Протоколы обнаружения канального уровня:
<details>
    - LLDP (Link Layer Discovery Protocol)<br>
    - CDP (Cisco Discovery Protocol)<br>
    - FDP (Foundry Discovery Protocol)<br>
    - MNDP (MikroTik Neighbor Discovery protocol)<br>
    - NDP (Nortel Discovery Protocol)<br>
    - EDP (Extreme Discovery Protocol)<br>
    - LLTD (Link Layer Topology Discovery)<br>
</details>

* В Linux используется пакет lldpd, [Пакет Ubuntu (apt)](https://packages.ubuntu.com/bionic/net/lldpd "Ubuntu")\
Командой `lldpctl` можно посмотреть соседей.\
То же самое можно увидеть командой `lldpcli sh neigh`\
`lldpcli sh stat sum` покажет общую статистику по всем интерфейсам: переданные, полученные пакеты и тд.\
`lldpcli sh int` покажет информацию по интерфейсам, на которых запущен lldpd.

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

- Используется технология VLAN стандарта IEEE 802.1Q
- Используются пакеты iproute2, NetworkManager, vconfig, vlan.


- пример конфига netplan
```yaml
network:
    version: 2
    renderer: networkd
    ethernets:
        ens3: {}
    vlans: 
        vlan5:
            id: 5
            link: ens3
            dhcp4: no
            addresses: [10.0.0.15/24]
            gateway: 10.0.0.1
```
4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

В Linux есть две технологии агрегации: bond и team. Изучил только первый.
Посмотреть какие типы агрегации предлает bond можно в информации о модуле ядра:
```shell
$ modinfo bonding | grep mode:
parm:           mode:Mode of operation; 0 for balance-rr, 1 for active-backup, 2 for balance-xor, 3 for broadcast, 4 for 802.3ad, 5 for balance-tlb, 6 for balance-alb (charp)
```

- **Mode-0(balance-rr)** – Данный режим используется по умолчанию. Balance-rr обеспечивается **балансировку нагрузки** и отказоустойчивость. В данном режиме сетевые пакеты отправляются “по кругу”, от первого интерфейса к последнему. Если выходят из строя интерфейсы, пакеты отправляются на остальные оставшиеся. Дополнительной настройки коммутатора не требуется при нахождении портов в одном коммутаторе. При разностных коммутаторах требуется дополнительная настройка.

- **Mode-1(active-backup)** – Один из интерфейсов работает в активном режиме, остальные в ожидающем. При обнаружении проблемы на активном интерфейсе производится переключение на ожидающий интерфейс. Не требуется поддержки от коммутатора.

- **Mode-2(balance-xor)** – Передача пакетов распределяется по типу входящего и исходящего трафика по формуле ((MAC src) XOR (MAC dest)) % число интерфейсов. Режим дает **балансировку нагрузки** и отказоустойчивость. Не требуется дополнительной настройки коммутатора/коммутаторов.

- **Mode-3(broadcast)** – Происходит передача во все объединенные интерфейсы, тем самым обеспечивая отказоустойчивость. Рекомендуется только для использования MULTICAST трафика.

- **Mode-4(802.3ad)** – динамическое объединение одинаковых портов. В данном режиме можно значительно увеличить пропускную способность входящего так и исходящего трафика. Для данного режима необходима поддержка и настройка коммутатора/коммутаторов.

- **Mode-5(balance-tlb)** – Адаптивная **балансировки нагрузки** трафика. Входящий трафик получается только активным интерфейсом, исходящий распределяется в зависимости от текущей загрузки канала каждого интерфейса. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

- **Mode-6(balance-alb)** – Адаптивная **балансировка нагрузки**. Отличается более совершенным алгоритмом балансировки нагрузки чем Mode-5). Обеспечивается балансировку нагрузки как исходящего, так и входящего трафика. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

`$ sudo nano /etc/netplan/01-netcfg.yaml`
```yaml
network:
  version: 2
  ethernets:
    eth0:
      dhcp4: true
    eth1:
      dhcp4: no
    eth2:
      dhcp4: no
  bonds:
   bond0:
    addresses: [192.168.70.5/24]
    interfaces: [eth1, eth2]
    parameters:
      mode: balance-rr
```
```shell
vagrant@vagrant:~$ sudo netplan apply
vagrant@vagrant:~$ ip a show bond0
5: bond0: <BROADCAST,MULTICAST,MASTER,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 0a:20:6c:5c:14:43 brd ff:ff:ff:ff:ff:ff
    inet 192.168.70.5/24 brd 192.168.70.255 scope global bond0
       valid_lft forever preferred_lft forever
    inet6 fe80::820:6cff:fe5c:1443/64 scope link
       valid_lft forever preferred_lft forever
```

5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.
- Сеть с маской /24 можно разбить на 32 подсети с маской /29
- можно попользовать консольную утилитку, если самому считать не очень хочется:
```shell
vagrant@vagrant:~$ ipcalc 10.0.0.0/29 --split 29
Address:   10.0.0.0             00001010.00000000.00000000.00000 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.0.0.0/29          00001010.00000000.00000000.00000 000
HostMin:   10.0.0.1             00001010.00000000.00000000.00000 001
HostMax:   10.0.0.6             00001010.00000000.00000000.00000 110
Broadcast: 10.0.0.7             00001010.00000000.00000000.00000 111
Hosts/Net: 6                     Class A, Private Internet

1. Requested size: 29 hosts
Netmask:   255.255.255.224 = 27 11111111.11111111.11111111.111 00000
Network:   10.0.0.0/27          00001010.00000000.00000000.000 00000
HostMin:   10.0.0.1             00001010.00000000.00000000.000 00001
HostMax:   10.0.0.30            00001010.00000000.00000000.000 11110
Broadcast: 10.0.0.31            00001010.00000000.00000000.000 11111
Hosts/Net: 30                    Class A, Private Internet

Network is too small
Needed size:  32 addresses.
Used network: 10.0.0.0/26.999999999999999999999999999999999999999
Unused:

```
6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

`100.64.0.0/26`
7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

- Ubuntu \
`ip neighbour show` - показать ARP таблицу \
`ip neighbour del [ip address] dev [interface]` - удалить из ARP таблицы конкретный адрес \
`ip neighbour flush all` - очищает таблицу ARP

- Windows \
`arp -a` - показать ARP таблицу \
`arp -d *` - очистить таблицу ARP \
`arp -d [ip address]` - удалить из ARP таблицы конкретный адрес \
---

## Задание для самостоятельной отработки (необязательно к выполнению)

8*. Установите эмулятор EVE-ng.

Инструкция по установке - https://github.com/svmyasnikov/eve-ng

Выполните задания на lldp, vlan, bonding в эмуляторе EVE-ng.
> - [x] Done \
Но на проекте https://www.pnetlab.com/pages/main
